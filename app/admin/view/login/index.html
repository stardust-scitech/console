<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Admin-登录</title>
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <link rel="stylesheet" type="text/css" href="../../../public/static/admin2/css/admin.css" />
        <link rel="stylesheet" type="text/css" href="../../../public/static/index/layui/css/layui.css" />
        <script type="text/javascript" src="../../../public/static/index/layui/layui.js"></script>
    </head>
    <body style="background: #fff">
        <div class="layui-container">
            <form id="form" class="layui-form login_form" action="" method="post"> 
                <!-- target="postFrame" -->
                <h2 class="text_center mar_b_30">后台登录</h2>
                <div class="layui-form-item">
                        <input type="text" name="username" required lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-item">
                        <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-item">
                    <input id="verifycode" type="text" name="verifycode" required lay-verify="required" placeholder="请输入两位验证码" autocomplete="off" class="layui-input fleft" style="width: 200px">
                    <img id="captcha" src="{:captcha_src()}" alt="captcha" onClick="this.src='{:captcha_src()}?'+Math.random();"/>
                </div>
                <div class="layui-form-item text_center mar_t_30">
                    <button id="submit" class="layui-btn" type="button" onclick="submitForm()";>立即提交</button>
                </div>
            </form>
            <!-- <iframe id="frameSubmit" frameborder="0" style="display:none" name="postFrame"></iframe> -->
            <!-- <iframe id="frameSubmit" style="width: 100%;height: 100%;" name="postFrame"></iframe> -->
            <script>

                layui.use('form', function ()
                {
                    var form = layui.form;
                });

                function submitForm() 
                {
                    $("#form").ajaxSubmit(function(data)
                    { 
                        console.log(data);
                        var json = JSON.parse(data);

                        if(json.redirect == './index') 
                        {
                            location.reload();
                        }
                        else
                        {
                            Popup(json.msg, json.icon);
                            if(json.captcha)
                            {
                                document.getElementById("verifycode").value = '';
                                document.getElementById("captcha").src = json.captcha;
                                // <img id="captcha" src="{:captcha_src()}" alt="captcha" onClick="this.src='{:captcha_src()}?'+Math.random();"/>
                            }
                            // $("#captcha").attr('src','{:captcha_src()}?tm='+Math.random());//刷新验证码
                        }
                        // $(this).resetForm(); // 提交后重置表单
                    });
                    return false; // 必须返回false，否则表单会自己再做一次提交操作，并且页面跳转
                }

                document.onkeydown = (e) => {
                    if(e.keyCode == 13) {
                        document.getElementById("submit").click();
                    }
                }

                function Popup(msg='', icon='', time=3)
                {
                    layer.msg(msg, {icon:5, time:time*1000});
                }
            </script>
        </div>
        {include file="public/foot"}
    </body>
</html>